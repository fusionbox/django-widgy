language: python
python:
  - "2.7"
  - "2.6"
env:
  global:
    - SOUTH_TESTS_MIGRATE=1
  matrix:
    - DATABASE_ENGINE=sqlite DJANGO_PACKAGE=Django==1.5.1
    - DATABASE_ENGINE=sqlite DJANGO_PACKAGE=https://github.com/django/django/archive/stable/1.6.x.zip
    - DATABASE_ENGINE=sqlite DJANGO_PACKAGE=Django==1.4.5
    - DATABASE_ENGINE=postgres DJANGO_PACKAGE=Django==1.5.1
    - DATABASE_ENGINE=postgres DJANGO_PACKAGE=https://github.com/django/django/archive/stable/1.6.x.zip
    - DATABASE_ENGINE=postgres DJANGO_PACKAGE=Django==1.4.5
    - DATABASE_ENGINE=mysql DJANGO_PACKAGE=Django==1.5.1
    - DATABASE_ENGINE=mysql DJANGO_PACKAGE=https://github.com/django/django/archive/stable/1.6.x.zip
    - DATABASE_ENGINE=mysql DJANGO_PACKAGE=Django==1.4.5
install:
  - pip install -q $DJANGO_PACKAGE --use-mirrors
  - pip install -q --use-mirrors mock
  - |
    if [ "$DATABASE_ENGINE" = "mysql" ]
    then
      pip install -q --use-mirrors MySQL-python
    fi
  - |
    if [ "$DATABASE_ENGINE" = "postgres" ]
    then
      pip install -q --use-mirrors psycopg2
    fi
  - pip install --use-mirrors .
  # mezzanine tries to override our django version sometimes
  - |
    if [ "`pip freeze|grep '^Django=='`" != "$DJANGO_PACKAGE" ]
    then
      pip install -q --use-mirrors $DJANGO_PACKAGE
    fi
before_script:
  - psql -c 'create database widgy;' -U postgres
  - mysql -e 'create database widgy;'
script: make test-py
